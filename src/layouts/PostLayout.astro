---
import ContentLayout from "./ContentLayout.astro";
import type { PostFrontmatter } from "../types";

interface Props {
  frontmatter: PostFrontmatter;
  headings: { depth: number, slug: string, text: string }[];
}

const { frontmatter, headings } = Astro.props;
const { pathname } = Astro.url;
---

<ContentLayout pageId={pathname.split("/")[1]} pageTitle={frontmatter.title}>
  <div class="mb-3">
    <div class="desc">{frontmatter.description}</div>
    <div class="meta mb-3">
      {
        frontmatter.tags ? (
          <div class="tags">
            {(frontmatter.tags ?? []).map((tag) => (
              <span class="tag">#{tag}</span>
            ))}
          </div>
        ) : (
          "no tags :("
        )
      }
      <div class="date">
        {
          frontmatter.dates.edited ? (
            <div>last edited {frontmatter.dates.edited}</div>
            <div>(originally published {frontmatter.dates.publish})</div>
          ) : frontmatter.dates.publish
        }
      </div>
    </div>
  </div>
  <hr>
  <div class="post-content">
    <slot></slot>
  </div>
</ContentLayout>

<script>
  window.addEventListener("load", () => {
    let state: {[index: string]: boolean} = {};
    document.querySelectorAll<HTMLElement>("[data-target-answer]").forEach((btn) => {
      btn.addEventListener("mousedown", (e) => {
        if (!btn.dataset.targetAnswer) {
          return;
        }

        if (!state[btn.dataset.targetAnswer]) {
          state[btn.dataset.targetAnswer] = false;
        }

        state[btn.dataset.targetAnswer] = !state[btn.dataset.targetAnswer];
        document.querySelectorAll<HTMLElement>(`[data-answer='${btn.dataset.targetAnswer}'`).forEach((ans) => ans.style.display = state[btn.dataset.targetAnswer] ? 'inline' : 'none');
      });
    });
  });
</script>

<style lang="scss">
  .title {
    margin-bottom: 0.5rem;
  }

  .desc {
    margin-bottom: 0.5rem;
    font-style: italic
  }

  .meta {
    color: var(--ctp-subtext0);
    display: flex;
    flex-flow: column;

    .tag {
      margin-right: 4px;
    }

    .date {
      margin-left: auto;
      text-align: right;
      font-style: italic;
    }
  }
</style>

<style is:global lang="scss">
  .post-content {
    @for $i from 1 through 5 {
      h#{$i} {
        margin: revert;
      }
    }

    p {
      margin: revert;
    }

    img {
      width: 100%;
    }
  }

  [data-answer] {
    display: none;
  }
</style>
